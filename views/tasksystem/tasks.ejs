<html>
  <head>
    <%- include("../base.ejs") %>
    <link rel="stylesheet" href="/css/tasks.css" />
  </head>
  <body>
    <br /><br />
    <div class="container">
      <% if(currentUser.admin > 0) { %>

      <div class="task-form-container">
        <h3 style="font-size: 20px"><i class="fas fa-tasks"></i> Task Form</h3>
        <!-- Adding tasks here -->
        <form class="form" method="POST" action="/addt">
          <div class="form-group mx-sm-3 mb-2">
            <label for="tasktitleinput">Main task title: </label>
            <input
              type="text"
              class="form-control"
              id="tasktitleinput"
              placeholder="Write a descriptive task title..."
              name="title"
              required
            />

            <label for="periodinput">The tasks will reset: </label>
            <select
              class="d-block mb-2"
              id="periodinput"
              name="period"
              style="width: 100%"
              required
            >
              <option value="day">Daily</option>
              <option value="week">Weekly</option>
              <option value="fortnight">in a fortnight (14 day)</option>
              <option value="month">Monthly</option>
            </select>
            <center>
              <button
                type="submit"
                class="btn btn-success mb-2"
                style="width: 50%"
              >
                <i class="fas fa-plus-square"></i> Add a main task
              </button>
            </center>
          </div>
        </form>
      </div>

      <% } %>

      <!-- Displaying daily tasks here -->
      <% const dailyTasks = tasks.filter((task) => { return task.period ==
      "day"}) %> <% if(dailyTasks.length > 0) { %>
      <div class="period-dropdown">
        <h2>Daily</h2>
        <% tasks.forEach((task) => { %> <% if(task.period == "day") {%>
        <div class="task" id="display-<%= task.id %>">
          <!-- The button is the only thing that executes the function directly -->
          <h5 class="title">
            <button
              class="toggleButton"
              onclick="toggleDisplay('<%= task.id %>')"
            >
              <span id="toggleSymbol"><i class="fas fa-angle-up"></i></span>
            </button>
            <%= task.title %>
          </h5>

          <div id="toggleDiv">
            <% if(currentUser.admin > 0) { %>
            <!-- Remove task modal -->
            <div class="btn-group" role="group" aria-label="Basic example">
              <a
                href="/edittask/<%= task.id %>"
                class="btn btn-dark mt-2 mb-2 d-block"
                ><i class="fas fa-wrench"></i> edit</a
              >
              <button
                type="button"
                class="btn btn-danger mt-2 mb-2 d-block"
                data-toggle="modal"
                data-target="#task-<%= task.id %>"
              >
                <i class="lni lni-trash"></i> delete
              </button>
            </div>

            <!-- Modal -->
            <div
              class="modal fade"
              id="task-<%= task.id %>"
              tabindex="-1"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header" style="color: black">
                    <h5 class="modal-title" id="exampleModalLabel">
                      Verification
                    </h5>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" style="color: black">
                    Do you want to delete this task?
                    <span style="font-weight: 700">"<%= task.title %>"</span>?
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-dismiss="modal"
                    >
                      Cancel
                    </button>
                    <form action="/rmt" method="POST">
                      <input
                        type="text"
                        name="id"
                        value="<%= task.id %>"
                        style="display: none"
                      />
                      <button class="btn btn-danger">
                        <i class="lni lni-trash"></i> delete
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <% } %> <% if(currentUser.admin > 0) { %>
            <!-- Add a subtask -->
            <form class="form-inline" method="POST" action="/addst">
              <div class="form-group mb-2 mr-2">
                <label for="inputPassword2" class="sr-only">Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="inputPassword2"
                  placeholder="Subtask-Titel"
                  name="title"
                  required
                />
                <input
                  type="text"
                  class="form-control"
                  id="inputPassword2"
                  placeholder="parentid"
                  name="parentid"
                  value="<%= task.id %>"
                  style="display: none"
                />
              </div>
              <button type="submit" class="btn btn-primary mb-2">+</button>
            </form>
            <% } %> <% subtasks.forEach((subtask) => { %> <%
            if(subtask.parent_id == task.id) { %>
            <div
              class="subtask <% if(subtask.completer_id) { %> completed <% } %>"
              id="position-<%= subtask.id %> "
            >
              <% if(subtask.completer_id) { %>
              <!-- Showing the completer username -->
              <span class="completer">
                <% users.forEach(user => { %> <% if(user.id ==
                subtask.completer_id) { %>
                <i class="lni lni-checkmark"></i> <%= user.username %> <% } %>
                <% }) %>
              </span>
              <br />
              <% } %>

              <span class="subtitle"><%= subtask.title %></span>
              <br />
              <% if(currentUser.admin > 0) { %>
              <a
                href="/editsubtask/<%= subtask.id %>"
                class="btn btn-dark mr-0.5 d-inline-block"
                ><i class="fas fa-wrench"></i>
                <span class="text-display">edit</span></a
              >
              <% } %>
              <!-- Complete form -->
              <% if(!subtask.completer_id) { %>

              <!-- Complete Verification  -->
              <button
                type="button"
                class="btn btn-success"
                data-toggle="modal"
                data-target="#complete-<%= subtask.id %>"
              >
                <i class="lni lni-checkmark"></i>
                <span class="text-display">Complete</span>
              </button>

              <!-- Modal -->
              <div
                class="modal fade"
                id="complete-<%= subtask.id%>"
                tabindex="-1"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5
                        class="modal-title"
                        id="exampleModalLabel"
                        style="color: black"
                      >
                        Complete ?
                      </h5>
                      <button
                        type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body" style="color: black">
                      Sind Sie sicher, dass Sie die Aufgabe abCancel möchten
                      <span style="font-weight: 700"
                        >"<%= subtask.title %>"</span
                      >?
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-dismiss="modal"
                      >
                        Cancel
                      </button>
                      <form class="d-inline" action="/completest" method="POST">
                        <input
                          type="text"
                          name="id"
                          value="<%= subtask.id %>"
                          style="display: none"
                        />
                        <button class="btn btn-success">
                          <i class="lni lni-checkmark"></i>
                          <span>Complete</span>
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <% } %> <% if(currentUser.admin > 0) { %>
              <!-- Remove subtask modal -->
              <!-- Button trigger modal -->
              <button
                type="button"
                class="btn btn-danger"
                data-toggle="modal"
                data-target="#subtask-<%= subtask.id %>"
              >
                <i class="lni lni-trash"></i>
                <span class="text-display">delete</span>
              </button>
              <!-- Modal -->
              <div
                class="modal fade"
                id="subtask-<%= subtask.id%>"
                tabindex="-1"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5
                        class="modal-title"
                        id="exampleModalLabel"
                        style="color: black"
                      >
                        delete ?
                      </h5>
                      <button
                        type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body" style="color: black">
                      Do you want to delete this task?
                      <span style="font-weight: 700"
                        >"<%= subtask.title %>"</span
                      >?
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-dismiss="modal"
                      >
                        Cancel
                      </button>
                      <form class="d-inline" action="/rmst" method="POST">
                        <input
                          type="text"
                          name="id"
                          value="<%= subtask.id %>"
                          style="display: none"
                        />
                        <button class="btn btn-danger">
                          <i class="lni lni-trash"></i> <span>delete</span>
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <% } %>

              <a href="/notes/<%= subtask.id %>" class="btn btn-primary"
                ><i class="lni lni-pencil-alt"></i
                ><span class="text-display">Notes</span>

                <% if(countNote(notes, subtask.id) > 0) { %>
                <span class="badge badge-pill badge-danger"
                  ><%= countNote(notes, subtask.id) %>
                </span>
                <% } %>
              </a>
            </div>
            <% } %> <% }) %>
          </div>
        </div>
        <% } %> <% }) %>
      </div>
      <% } %>

      <!-- Displaying week period tasks here -->

      <% const weeklyTasks = tasks.filter((task) => { return task.period ==
      "week"}) %> <% if(weeklyTasks.length > 0) { %>
      <div class="period-dropdown">
        <h2>Weekly</h2>
        <% tasks.forEach((task) => { %> <% if(task.period == "week") {%>
        <div class="task" id="display-<%= task.id %>">
          <!-- The button is the only thing that executes the function directly -->
          <h5 class="title">
            <button
              class="toggleButton"
              onclick="toggleDisplay('<%= task.id %>')"
            >
              <span id="toggleSymbol"><i class="fas fa-angle-up"></i></span>
            </button>
            <%= task.title %>
          </h5>

          <div id="toggleDiv">
            <% if(currentUser.admin > 0) { %>
            <!-- Remove task modal -->
            <div class="btn-group" role="group" aria-label="Basic example">
              <a
                href="/edittask/<%= task.id %>"
                class="btn btn-dark mt-2 mb-2 d-block"
                ><i class="fas fa-wrench"></i> edit</a
              >
              <button
                type="button"
                class="btn btn-danger mt-2 mb-2 d-block"
                data-toggle="modal"
                data-target="#task-<%= task.id %>"
              >
                <i class="lni lni-trash"></i> delete
              </button>
            </div>

            <!-- Modal -->
            <div
              class="modal fade"
              id="task-<%= task.id %>"
              tabindex="-1"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header" style="color: black">
                    <h5 class="modal-title" id="exampleModalLabel">
                      Verification
                    </h5>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" style="color: black">
                    Do you want to delete this task?
                    <span style="font-weight: 700">"<%= task.title %>"</span>?
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-dismiss="modal"
                    >
                      Cancel
                    </button>
                    <form action="/rmt" method="POST">
                      <input
                        type="text"
                        name="id"
                        value="<%= task.id %>"
                        style="display: none"
                      />
                      <button class="btn btn-danger">
                        <i class="lni lni-trash"></i> delete
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <% } %> <% if(currentUser.admin > 0) { %>
            <!-- Add a subtask -->
            <form class="form-inline" method="POST" action="/addst">
              <div class="form-group mb-2 mr-2">
                <label for="inputPassword2" class="sr-only">Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="inputPassword2"
                  placeholder="Subtask-Titel"
                  name="title"
                  required
                />
                <input
                  type="text"
                  class="form-control"
                  id="inputPassword2"
                  placeholder="parentid"
                  name="parentid"
                  value="<%= task.id %>"
                  style="display: none"
                />
              </div>
              <button type="submit" class="btn btn-primary mb-2">+</button>
            </form>
            <% } %> <% subtasks.forEach((subtask) => { %> <%
            if(subtask.parent_id == task.id) { %>
            <div
              class="subtask <% if(subtask.completer_id) { %> completed <% } %>"
              id="position-<%= subtask.id %> "
            >
              <% if(subtask.completer_id) { %>
              <!-- Showing the completer username -->
              <span class="completer">
                <% users.forEach(user => { %> <% if(user.id ==
                subtask.completer_id) { %>
                <i class="lni lni-checkmark"></i> <%= user.username %> <% } %>
                <% }) %>
              </span>
              <br />
              <% } %>

              <span class="subtitle"><%= subtask.title %></span>
              <br />
              <% if(currentUser.admin > 0) { %>
              <a
                href="/editsubtask/<%= subtask.id %>"
                class="btn btn-dark mr-0.5 d-inline-block"
                ><i class="fas fa-wrench"></i>
                <span class="text-display">edit</span></a
              >
              <% } %>
              <!-- Complete form -->
              <% if(!subtask.completer_id) { %>

              <!-- Complete Verification  -->
              <button
                type="button"
                class="btn btn-success"
                data-toggle="modal"
                data-target="#complete-<%= subtask.id %>"
              >
                <i class="lni lni-checkmark"></i>
                <span class="text-display">Complete</span>
              </button>

              <!-- Modal -->
              <div
                class="modal fade"
                id="complete-<%= subtask.id%>"
                tabindex="-1"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5
                        class="modal-title"
                        id="exampleModalLabel"
                        style="color: black"
                      >
                        Complete ?
                      </h5>
                      <button
                        type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body" style="color: black">
                      Sind Sie sicher, dass Sie die Aufgabe abCancel möchten
                      <span style="font-weight: 700"
                        >"<%= subtask.title %>"</span
                      >?
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-dismiss="modal"
                      >
                        Cancel
                      </button>
                      <form class="d-inline" action="/completest" method="POST">
                        <input
                          type="text"
                          name="id"
                          value="<%= subtask.id %>"
                          style="display: none"
                        />
                        <button class="btn btn-success">
                          <i class="lni lni-checkmark"></i>
                          <span>Complete</span>
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <% } %> <% if(currentUser.admin > 0) { %>
              <!-- Remove subtask modal -->
              <!-- Button trigger modal -->
              <button
                type="button"
                class="btn btn-danger"
                data-toggle="modal"
                data-target="#subtask-<%= subtask.id %>"
              >
                <i class="lni lni-trash"></i>
                <span class="text-display">delete</span>
              </button>
              <!-- Modal -->
              <div
                class="modal fade"
                id="subtask-<%= subtask.id%>"
                tabindex="-1"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5
                        class="modal-title"
                        id="exampleModalLabel"
                        style="color: black"
                      >
                        delete ?
                      </h5>
                      <button
                        type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body" style="color: black">
                      Do you want to delete this task?
                      <span style="font-weight: 700"
                        >"<%= subtask.title %>"</span
                      >?
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-dismiss="modal"
                      >
                        Cancel
                      </button>
                      <form class="d-inline" action="/rmst" method="POST">
                        <input
                          type="text"
                          name="id"
                          value="<%= subtask.id %>"
                          style="display: none"
                        />
                        <button class="btn btn-danger">
                          <i class="lni lni-trash"></i> <span>delete</span>
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <% } %>

              <a href="/notes/<%= subtask.id %>" class="btn btn-primary"
                ><i class="lni lni-pencil-alt"></i
                ><span class="text-display">Notes</span>

                <% if(countNote(notes, subtask.id) > 0) { %>
                <span class="badge badge-pill badge-danger"
                  ><%= countNote(notes, subtask.id) %>
                </span>
                <% } %>
              </a>
            </div>
            <% } %> <% }) %>
          </div>
        </div>
        <% } %> <% }) %>
      </div>
      <% } %>

      <!-- Displaying fortnight period tasks here -->

      <% const fortnightlyTasks = tasks.filter((task) => { return task.period ==
      "fortnight"}) %> <% if(fortnightlyTasks.length > 0) { %>
      <div class="period-dropdown">
        <h2>In a fortnight (14 day)</h2>
        <% tasks.forEach((task) => { %> <% if(task.period == "fortnight") {%>
        <div class="task" id="display-<%= task.id %>">
          <!-- The button is the only thing that executes the function directly -->
          <h5 class="title">
            <button
              class="toggleButton"
              onclick="toggleDisplay('<%= task.id %>')"
            >
              <span id="toggleSymbol"><i class="fas fa-angle-up"></i></span>
            </button>
            <%= task.title %>
          </h5>

          <div id="toggleDiv">
            <% if(currentUser.admin > 0) { %>
            <!-- Remove task modal -->
            <div class="btn-group" role="group" aria-label="Basic example">
              <a
                href="/edittask/<%= task.id %>"
                class="btn btn-dark mt-2 mb-2 d-block"
                ><i class="fas fa-wrench"></i> edit</a
              >
              <button
                type="button"
                class="btn btn-danger mt-2 mb-2 d-block"
                data-toggle="modal"
                data-target="#task-<%= task.id %>"
              >
                <i class="lni lni-trash"></i> delete
              </button>
            </div>

            <!-- Modal -->
            <div
              class="modal fade"
              id="task-<%= task.id %>"
              tabindex="-1"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header" style="color: black">
                    <h5 class="modal-title" id="exampleModalLabel">
                      Verification
                    </h5>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" style="color: black">
                    Do you want to delete this task?
                    <span style="font-weight: 700">"<%= task.title %>"</span>?
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-dismiss="modal"
                    >
                      Cancel
                    </button>
                    <form action="/rmt" method="POST">
                      <input
                        type="text"
                        name="id"
                        value="<%= task.id %>"
                        style="display: none"
                      />
                      <button class="btn btn-danger">
                        <i class="lni lni-trash"></i> delete
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <% } %> <% if(currentUser.admin > 0) { %>
            <!-- Add a subtask -->
            <form class="form-inline" method="POST" action="/addst">
              <div class="form-group mb-2 mr-2">
                <label for="inputPassword2" class="sr-only">Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="inputPassword2"
                  placeholder="Subtask-Titel"
                  name="title"
                  required
                />
                <input
                  type="text"
                  class="form-control"
                  id="inputPassword2"
                  placeholder="parentid"
                  name="parentid"
                  value="<%= task.id %>"
                  style="display: none"
                />
              </div>
              <button type="submit" class="btn btn-primary mb-2">+</button>
            </form>
            <% } %> <% subtasks.forEach((subtask) => { %> <%
            if(subtask.parent_id == task.id) { %>
            <div
              class="subtask <% if(subtask.completer_id) { %> completed <% } %>"
              id="position-<%= subtask.id %> "
            >
              <% if(subtask.completer_id) { %>
              <!-- Showing the completer username -->
              <span class="completer">
                <% users.forEach(user => { %> <% if(user.id ==
                subtask.completer_id) { %>
                <i class="lni lni-checkmark"></i> <%= user.username %> <% } %>
                <% }) %>
              </span>
              <br />
              <% } %>

              <span class="subtitle"><%= subtask.title %></span>
              <br />
              <% if(currentUser.admin > 0) { %>
              <a
                href="/editsubtask/<%= subtask.id %>"
                class="btn btn-dark mr-0.5 d-inline-block"
                ><i class="fas fa-wrench"></i>
                <span class="text-display">edit</span></a
              >
              <% } %>
              <!-- Complete form -->
              <% if(!subtask.completer_id) { %>

              <!-- Complete Verification  -->
              <button
                type="button"
                class="btn btn-success"
                data-toggle="modal"
                data-target="#complete-<%= subtask.id %>"
              >
                <i class="lni lni-checkmark"></i>
                <span class="text-display">Complete</span>
              </button>

              <!-- Modal -->
              <div
                class="modal fade"
                id="complete-<%= subtask.id%>"
                tabindex="-1"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5
                        class="modal-title"
                        id="exampleModalLabel"
                        style="color: black"
                      >
                        Complete ?
                      </h5>
                      <button
                        type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body" style="color: black">
                      Sind Sie sicher, dass Sie die Aufgabe abCancel möchten
                      <span style="font-weight: 700"
                        >"<%= subtask.title %>"</span
                      >?
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-dismiss="modal"
                      >
                        Cancel
                      </button>
                      <form class="d-inline" action="/completest" method="POST">
                        <input
                          type="text"
                          name="id"
                          value="<%= subtask.id %>"
                          style="display: none"
                        />
                        <button class="btn btn-success">
                          <i class="lni lni-checkmark"></i>
                          <span>Complete</span>
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <% } %> <% if(currentUser.admin > 0) { %>
              <!-- Remove subtask modal -->
              <!-- Button trigger modal -->
              <button
                type="button"
                class="btn btn-danger"
                data-toggle="modal"
                data-target="#subtask-<%= subtask.id %>"
              >
                <i class="lni lni-trash"></i>
                <span class="text-display">Delete</span>
              </button>
              <!-- Modal -->
              <div
                class="modal fade"
                id="subtask-<%= subtask.id%>"
                tabindex="-1"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5
                        class="modal-title"
                        id="exampleModalLabel"
                        style="color: black"
                      >
                        Delete ?
                      </h5>
                      <button
                        type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body" style="color: black">
                      Do you want to delete this task?
                      <span style="font-weight: 700"
                        >"<%= subtask.title %>"</span
                      >?
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-dismiss="modal"
                      >
                        Cancel
                      </button>
                      <form class="d-inline" action="/rmst" method="POST">
                        <input
                          type="text"
                          name="id"
                          value="<%= subtask.id %>"
                          style="display: none"
                        />
                        <button class="btn btn-danger">
                          <i class="lni lni-trash"></i> <span>delete</span>
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <% } %>

              <a href="/notes/<%= subtask.id %>" class="btn btn-primary"
                ><i class="lni lni-pencil-alt"></i
                ><span class="text-display">Notes</span>

                <% if(countNote(notes, subtask.id) > 0) { %>
                <span class="badge badge-pill badge-danger"
                  ><%= countNote(notes, subtask.id) %>
                </span>
                <% } %>
              </a>
            </div>
            <% } %> <% }) %>
          </div>
        </div>
        <% } %> <% }) %>
      </div>
      <% } %>

      <!-- Displaying month period tasks here -->

      <% const monthlyTasks = tasks.filter((task) => { return task.period ==
      "month"}) %> <% if(monthlyTasks.length > 0) { %>
      <div class="period-dropdown">
        <h2>Monthly</h2>
        <% tasks.forEach((task) => { %> <% if(task.period == "month") {%>
        <div class="task" id="display-<%= task.id %>">
          <!-- The button is the only thing that executes the function directly -->
          <h5 class="title">
            <button
              class="toggleButton"
              onclick="toggleDisplay('<%= task.id %>')"
            >
              <span id="toggleSymbol"><i class="fas fa-angle-up"></i></span>
            </button>
            <%= task.title %>
          </h5>

          <div id="toggleDiv">
            <% if(currentUser.admin > 0) { %>
            <!-- Remove task modal -->
            <div class="btn-group" role="group" aria-label="Basic example">
              <a
                href="/edittask/<%= task.id %>"
                class="btn btn-dark mt-2 mb-2 d-block"
                ><i class="fas fa-wrench"></i> edit</a
              >
              <button
                type="button"
                class="btn btn-danger mt-2 mb-2 d-block"
                data-toggle="modal"
                data-target="#task-<%= task.id %>"
              >
                <i class="lni lni-trash"></i> delete
              </button>
            </div>

            <!-- Modal -->
            <div
              class="modal fade"
              id="task-<%= task.id %>"
              tabindex="-1"
              aria-labelledby="exampleModalLabel"
              aria-hidden="true"
            >
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header" style="color: black">
                    <h5 class="modal-title" id="exampleModalLabel">
                      Verification
                    </h5>
                    <button
                      type="button"
                      class="close"
                      data-dismiss="modal"
                      aria-label="Close"
                    >
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <div class="modal-body" style="color: black">
                    Do you want to delete this task?
                    <span style="font-weight: 700">"<%= task.title %>"</span>?
                  </div>
                  <div class="modal-footer">
                    <button
                      type="button"
                      class="btn btn-secondary"
                      data-dismiss="modal"
                    >
                      Cancel
                    </button>
                    <form action="/rmt" method="POST">
                      <input
                        type="text"
                        name="id"
                        value="<%= task.id %>"
                        style="display: none"
                      />
                      <button class="btn btn-danger">
                        <i class="lni lni-trash"></i> delete
                      </button>
                    </form>
                  </div>
                </div>
              </div>
            </div>
            <% } %> <% if(currentUser.admin > 0) { %>
            <!-- Add a subtask -->
            <form class="form-inline" method="POST" action="/addst">
              <div class="form-group mb-2 mr-2">
                <label for="inputPassword2" class="sr-only">Title</label>
                <input
                  type="text"
                  class="form-control"
                  id="inputPassword2"
                  placeholder="Subtask-Titel"
                  name="title"
                  required
                />
                <input
                  type="text"
                  class="form-control"
                  id="inputPassword2"
                  placeholder="parentid"
                  name="parentid"
                  value="<%= task.id %>"
                  style="display: none"
                />
              </div>
              <button type="submit" class="btn btn-primary mb-2">+</button>
            </form>
            <% } %> <% subtasks.forEach((subtask) => { %> <%
            if(subtask.parent_id == task.id) { %>
            <div
              class="subtask <% if(subtask.completer_id) { %> completed <% } %>"
              id="position-<%= subtask.id %> "
            >
              <% if(subtask.completer_id) { %>
              <!-- Showing the completer username -->
              <span class="completer">
                <% users.forEach(user => { %> <% if(user.id ==
                subtask.completer_id) { %>
                <i class="lni lni-checkmark"></i> <%= user.username %> <% } %>
                <% }) %>
              </span>
              <br />
              <% } %>

              <span class="subtitle"><%= subtask.title %></span>
              <br />
              <% if(currentUser.admin > 0) { %>
              <a
                href="/editsubtask/<%= subtask.id %>"
                class="btn btn-dark mr-0.5 d-inline-block"
                ><i class="fas fa-wrench"></i>
                <span class="text-display">edit</span></a
              >
              <% } %>
              <!-- Complete form -->
              <% if(!subtask.completer_id) { %>

              <!-- Complete Verification  -->
              <button
                type="button"
                class="btn btn-success"
                data-toggle="modal"
                data-target="#complete-<%= subtask.id %>"
              >
                <i class="lni lni-checkmark"></i>
                <span class="text-display">Complete</span>
              </button>

              <!-- Modal -->
              <div
                class="modal fade"
                id="complete-<%= subtask.id%>"
                tabindex="-1"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5
                        class="modal-title"
                        id="exampleModalLabel"
                        style="color: black"
                      >
                        Completed ?
                      </h5>
                      <button
                        type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body" style="color: black">
                      Sind Sie sicher, dass Sie die Aufgabe abCancel möchten
                      <span style="font-weight: 700"
                        >"<%= subtask.title %>"</span
                      >?
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-dismiss="modal"
                      >
                        Cancel
                      </button>
                      <form class="d-inline" action="/completest" method="POST">
                        <input
                          type="text"
                          name="id"
                          value="<%= subtask.id %>"
                          style="display: none"
                        />
                        <button class="btn btn-success">
                          <i class="lni lni-checkmark"></i>
                          <span>Completed</span>
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <% } %> <% if(currentUser.admin > 0) { %>
              <!-- Remove subtask modal -->
              <!-- Button trigger modal -->
              <button
                type="button"
                class="btn btn-danger"
                data-toggle="modal"
                data-target="#subtask-<%= subtask.id %>"
              >
                <i class="lni lni-trash"></i>
                <span class="text-display">delete</span>
              </button>
              <!-- Modal -->
              <div
                class="modal fade"
                id="subtask-<%= subtask.id%>"
                tabindex="-1"
                aria-labelledby="exampleModalLabel"
                aria-hidden="true"
              >
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <h5
                        class="modal-title"
                        id="exampleModalLabel"
                        style="color: black"
                      >
                        delete ?
                      </h5>
                      <button
                        type="button"
                        class="close"
                        data-dismiss="modal"
                        aria-label="Close"
                      >
                        <span aria-hidden="true">&times;</span>
                      </button>
                    </div>
                    <div class="modal-body" style="color: black">
                      Do you want to delete this task?
                      <span style="font-weight: 700"
                        >"<%= subtask.title %>"</span
                      >?
                    </div>
                    <div class="modal-footer">
                      <button
                        type="button"
                        class="btn btn-secondary"
                        data-dismiss="modal"
                      >
                        Cancel
                      </button>
                      <form class="d-inline" action="/rmst" method="POST">
                        <input
                          type="text"
                          name="id"
                          value="<%= subtask.id %>"
                          style="display: none"
                        />
                        <button class="btn btn-danger">
                          <i class="lni lni-trash"></i> <span>delete</span>
                        </button>
                      </form>
                    </div>
                  </div>
                </div>
              </div>

              <% } %>

              <a href="/notes/<%= subtask.id %>" class="btn btn-primary"
                ><i class="lni lni-pencil-alt"></i
                ><span class="text-display">Notes</span>

                <% if(countNote(notes, subtask.id) > 0) { %>
                <span class="badge badge-pill badge-danger"
                  ><%= countNote(notes, subtask.id) %>
                </span>
                <% } %>
              </a>
            </div>
            <% } %> <% }) %>
          </div>
        </div>
        <% } %> <% }) %>
      </div>
      <% } %>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
      // Reloading the same refresh position [Beta] ***
      document.addEventListener("DOMContentLoaded", function (event) {
        var scrollpos = localStorage.getItem("scrollpos");
        if (scrollpos) window.scrollTo(0, scrollpos);
      });

      window.onbeforeunload = function (e) {
        localStorage.setItem("scrollpos", window.scrollY);
      };

      // Reloading ends here ***

      let tasks = document.querySelectorAll(".task");

      function defineCompletionClass(subtasks) {
        let truthTable = [];

        subtasks.forEach((subtask) => {
          truthTable.push(subtask.classList.contains("completed"));
        });

        if (truthTable.length > 0) {
          if (truthTable.includes(false)) {
            if (truthTable.includes(true)) {
              return "orange"; // orange class css
            } else {
              return "red"; // red class css
            }
          } else {
            return "green"; // green class css
          }
        } else {
          return "red";
        }
      }

      tasks.forEach((task) => {
        let subtasks = task.querySelectorAll(".subtask");
        let finalClass = defineCompletionClass(subtasks);
        task.classList.add(finalClass);
      });
    </script>

    <script src="/js/jquery/dist/jquery.js"></script>
    <script src="/js/default/hidetask.js"></script>
  </body>
</html>
